
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>API &#8212; Uncertainty Wrapper Terreneuvian Series documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Python Extension Example with Units" href="more_examples/python_extension_example_with_units.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="api">
<span id="id1"></span><h1>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-uncertainty_wrapper.core">
<span id="uncertainty-wrapper"></span><h2>Uncertainty Wrapper<a class="headerlink" href="#module-uncertainty_wrapper.core" title="Permalink to this headline">¶</a></h2>
<p>Uncertainty wrapper calculates uncertainties of wrapped functions using
central finite difference approximation of the Jacobian matrix.</p>
<div class="math notranslate nohighlight">
\[\frac{\partial f_i}{\partial x_{j,k}}\]</div>
<p>Uncertainty of the output is propagated using first order terms of a Taylor
series expansion around <span class="math notranslate nohighlight">\(x\)</span>.</p>
<div class="math notranslate nohighlight">
\[dF_{ij} = J_{ij} * S_{x_i, x_j} * J_{ij}^{T}\]</div>
<p>Diagonals of <span class="math notranslate nohighlight">\(dF_{ij}\)</span> are standard deviations squared.</p>
<p>SunPower Corp. (c) 2016</p>
<div class="section" id="step-size">
<h3>Step Size<a class="headerlink" href="#step-size" title="Permalink to this headline">¶</a></h3>
<dl class="py data">
<dt id="uncertainty_wrapper.core.DELTA">
<code class="sig-prename descclassname">uncertainty_wrapper.core.</code><code class="sig-name descname">DELTA</code><em class="property"> = 3.0277272261966714e-06</em><a class="headerlink" href="#uncertainty_wrapper.core.DELTA" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="partial-derivative">
<h3>Partial Derivative<a class="headerlink" href="#partial-derivative" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt id="uncertainty_wrapper.core.partial_derivative">
<code class="sig-prename descclassname">uncertainty_wrapper.core.</code><code class="sig-name descname">partial_derivative</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">f</span></em>, <em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">n</span></em>, <em class="sig-param"><span class="n">nargs</span></em>, <em class="sig-param"><span class="n">delta</span><span class="o">=</span><span class="default_value">3.0277272261966714e-06</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/uncertainty_wrapper/core.html#partial_derivative"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#uncertainty_wrapper.core.partial_derivative" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate partial derivative using central finite difference approximation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>f</strong> – function</p></li>
<li><p><strong>x</strong> – sequence of arguments</p></li>
<li><p><strong>n</strong> – index of argument derivateve is with respect to</p></li>
<li><p><strong>nargs</strong> – number of arguments</p></li>
<li><p><strong>delta</strong> – optional step size, default is <span class="math notranslate nohighlight">\(\epsilon^{1/3}\)</span> where
<span class="math notranslate nohighlight">\(\epsilon\)</span> is machine precision</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="jacobian">
<h3>Jacobian<a class="headerlink" href="#jacobian" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt id="uncertainty_wrapper.core.jacobian">
<code class="sig-prename descclassname">uncertainty_wrapper.core.</code><code class="sig-name descname">jacobian</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">nf</span></em>, <em class="sig-param"><span class="n">nobs</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/uncertainty_wrapper/core.html#jacobian"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#uncertainty_wrapper.core.jacobian" title="Permalink to this definition">¶</a></dt>
<dd><p>Estimate Jacobian matrices <span class="math notranslate nohighlight">\(\frac{\partial f_i}{\partial x_{j,k}}\)</span>
where <span class="math notranslate nohighlight">\(k\)</span> are independent observations of <span class="math notranslate nohighlight">\(x\)</span>.</p>
<p>The independent variable, <span class="math notranslate nohighlight">\(x\)</span>, must be a numpy array with exactly 2
dimensions. The first dimension is the number of independent arguments,
and the second dimensions is the number of observations.</p>
<p>The function must return a Numpy array with exactly 2 dimensions. The first
is the number of returns and the second dimension corresponds to the number
of observations. If the input argument is 2-D then the output should also
be 2-D</p>
<p>Constant arguments can be passed as additional positional arguments or
keyword arguments. If any constant argument increases the number of
observations of the return value, tile the input arguments to match.</p>
<p>Use <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.atleast_2d.html#numpy.atleast_2d" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.atleast_2d()</span></code></a> or <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.reshape.html#numpy.reshape" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.reshape()</span></code></a> to get the
correct dimensions for scalars.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> – function</p></li>
<li><p><strong>x</strong> – independent variables grouped by observation</p></li>
<li><p><strong>nf</strong> – number of return in output (1st dimension)</p></li>
<li><p><strong>nobs</strong> – number of observations in output (2nd dimension)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Jacobian matrices for each observation</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="flatten-jacobian">
<h3>Flatten Jacobian<a class="headerlink" href="#flatten-jacobian" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt id="uncertainty_wrapper.core.jflatten">
<code class="sig-prename descclassname">uncertainty_wrapper.core.</code><code class="sig-name descname">jflatten</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">j</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/uncertainty_wrapper/core.html#jflatten"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#uncertainty_wrapper.core.jflatten" title="Permalink to this definition">¶</a></dt>
<dd><p>Flatten 3_D Jacobian into 2-D.</p>
</dd></dl>

</div>
<div class="section" id="wrapper">
<h3>Wrapper<a class="headerlink" href="#wrapper" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt id="uncertainty_wrapper.core.unc_wrapper_args">
<code class="sig-prename descclassname">uncertainty_wrapper.core.</code><code class="sig-name descname">unc_wrapper_args</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">covariance_keys</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/uncertainty_wrapper/core.html#unc_wrapper_args"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#uncertainty_wrapper.core.unc_wrapper_args" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrap function, calculate its Jacobian and calculate the covariance of the
outputs given the covariance of the specified inputs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>covariance_keys</strong> – indices and names of arguments corresponding to
covariance</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>wrapped function bound to specified covariance keys</p>
</dd>
</dl>
<p>This is the outer uncertainty wrapper that allows you to specify the
arguments in the original function that correspond to the covariance. The
inner wrapper takes the original function to be wrapped.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">kw1</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1"># arguments a, c, d and kw1 correspond to the covariance matrix</span>
<span class="n">f_wrapped</span> <span class="o">=</span> <span class="n">unc_wrapper_args</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;kw1&#39;</span><span class="p">)(</span><span class="n">f</span><span class="p">)</span>

<span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">])</span>
<span class="n">y</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">jac</span> <span class="o">=</span> <span class="n">f_wrapped</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">kw1</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">__covariance__</span><span class="o">=</span><span class="n">cov</span><span class="p">)</span>
</pre></div>
</div>
<p>The covariance keys can be indices of positional arguments or the names of
keywords argument used in calling the function. If no covariance keys are
specified then the arguments that correspond to the covariance shoud be
grouped into a sequence. If <code class="docutils literal notranslate"><span class="pre">None</span></code> is anywhere in <code class="docutils literal notranslate"><span class="pre">covariance_keys</span></code> then
all of the arguments will be used to calculate the Jacobian.</p>
<p>The covariance matrix must be a symmetrical matrix with positive numbers on
the diagonal that correspond to the square of the standard deviation, second
moment around the mean or root-mean-square(RMS) of the function with respect
to the arguments specified as covariance keys. The other elements are the
covariances corresponding to the arguments intersecting at that element.
Pass the covariance matrix with the keyword <code class="docutils literal notranslate"><span class="pre">__covariance__</span></code> and it will
be popped from the dictionary of keyword arguments provided to the wrapped
function.</p>
<p>The wrapped function will return the evaluation of the original function,
its Jacobian, which is the sensitivity of the return output to each
argument specified as a covariance key and the covariance propagated using
the first order terms of a Taylor series expansion around the arguments.</p>
<p>An optional keyword argument <code class="docutils literal notranslate"><span class="pre">__method__</span></code> can also be passed to the
wrapped function (not the wrapper) that specifies the method used to
calculate the dot product. The default method is <code class="docutils literal notranslate"><span class="pre">'loop'</span></code>. The other
methods are <code class="docutils literal notranslate"><span class="pre">'dense'</span></code>, <code class="docutils literal notranslate"><span class="pre">'sparse'</span></code> and <code class="docutils literal notranslate"><span class="pre">'pool'</span></code>.</p>
<p>If the arguments specified as covariance keys are arrays, they should all be
the same size. These dimensions will be considered as separate observations.
Another argument, not in the covariance keys, may also create observations.
The resulting Jacobian will have dimensions of number of observations (nobs)
by number of return output (nf) by number of covariance keys (nargs). The
resulting covariance will be nobs x nf x nf.</p>
</dd></dl>

<div class="section" id="wrapper-shortcut">
<h4>Wrapper Shortcut<a class="headerlink" href="#wrapper-shortcut" title="Permalink to this headline">¶</a></h4>
<dl class="py function">
<dt id="uncertainty_wrapper.core.unc_wrapper">
<code class="sig-prename descclassname">uncertainty_wrapper.core.</code><code class="sig-name descname">unc_wrapper</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#uncertainty_wrapper.core.unc_wrapper" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This is basically <a class="reference internal" href="#uncertainty_wrapper.core.unc_wrapper_args" title="uncertainty_wrapper.core.unc_wrapper_args"><code class="xref py py-func docutils literal notranslate"><span class="pre">unc_wrapper_args()</span></code></a> with no argument which assumes that
all independent arguments are already grouped together.</p>
</div>
</div>
</div>
<div class="section" id="module-uncertainty_wrapper.tests.test_uncertainty_wrapper">
<span id="tests"></span><h2>Tests<a class="headerlink" href="#module-uncertainty_wrapper.tests.test_uncertainty_wrapper" title="Permalink to this headline">¶</a></h2>
<p>Tests for <code class="xref py py-func docutils literal notranslate"><span class="pre">unc_wrapper()</span></code> and
<code class="xref py py-func docutils literal notranslate"><span class="pre">unc_wrapper_args()</span></code></p>
<div class="section" id="test-uncertainty-wrapper">
<h3>Test Uncertainty Wrapper<a class="headerlink" href="#test-uncertainty-wrapper" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt id="uncertainty_wrapper.tests.test_uncertainty_wrapper.test_unc_wrapper">
<code class="sig-prename descclassname">uncertainty_wrapper.tests.test_uncertainty_wrapper.</code><code class="sig-name descname">test_unc_wrapper</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/uncertainty_wrapper/tests/test_uncertainty_wrapper.html#test_unc_wrapper"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#uncertainty_wrapper.tests.test_uncertainty_wrapper.test_unc_wrapper" title="Permalink to this definition">¶</a></dt>
<dd><p>Test uncertainty wrapper with grouped arguments.</p>
</dd></dl>

<p>Test simple exponential function with known derivative. Assert derivative is
correct and that uncertainty is propagated correctly.</p>
</div>
<div class="section" id="test-iv-curve">
<h3>Test IV curve<a class="headerlink" href="#test-iv-curve" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt id="uncertainty_wrapper.tests.test_uncertainty_wrapper.test_IV">
<code class="sig-prename descclassname">uncertainty_wrapper.tests.test_uncertainty_wrapper.</code><code class="sig-name descname">test_IV</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">method</span><span class="o">=</span><span class="default_value">'sparse'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/uncertainty_wrapper/tests/test_uncertainty_wrapper.html#test_IV"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#uncertainty_wrapper.tests.test_uncertainty_wrapper.test_IV" title="Permalink to this definition">¶</a></dt>
<dd><p>Test calculation of photovoltaic cell IV curve using 2-diode model and
and compare Jacobian estimated by finite central difference to AlgoPy
automatic differentiation.</p>
</dd></dl>

<p>Test complex function with several operations, including <span class="math notranslate nohighlight">\(exp\)</span>, <span class="math notranslate nohighlight">\(log\)</span>
and powers, with several input arguments and with several return values. Check
Jacobian calculated with central finite difference approximation with automatic
differentiation using AlgoPy.</p>
</div>
<div class="section" id="test-solar-position">
<h3>Test Solar Position<a class="headerlink" href="#test-solar-position" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt id="uncertainty_wrapper.tests.test_uncertainty_wrapper.test_solpos">
<code class="sig-prename descclassname">uncertainty_wrapper.tests.test_uncertainty_wrapper.</code><code class="sig-name descname">test_solpos</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">method</span><span class="o">=</span><span class="default_value">'loop'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/uncertainty_wrapper/tests/test_uncertainty_wrapper.html#test_solpos"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#uncertainty_wrapper.tests.test_uncertainty_wrapper.test_solpos" title="Permalink to this definition">¶</a></dt>
<dd><p>Test solar position calculation using NREL’s SOLPOS.</p>
</dd></dl>

<p>Test function from a Python C/C++ extension. Check calcuated Jacobian with John
D’Errico’s <code class="docutils literal notranslate"><span class="pre">numdifftools</span></code> Python package (MATLAB <code class="docutils literal notranslate"><span class="pre">derivest</span></code>).</p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/sp_2014_logo_black_orange_rgb.png" alt="Logo"/>
    
    <h1 class="logo logo-name">Uncertainty Wrapper</h1>
    
  </a>
</p>



<p class="blurb">Calculate uncertainty and sensitivity of any function</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=BreakingBytes&repo=UncertaintyWrapper&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/BreakingBytes/UncertaintyWrapper">
    <img
        alt="https://secure.travis-ci.org/BreakingBytes/UncertaintyWrapper.svg?branch=master"
        src="https://secure.travis-ci.org/BreakingBytes/UncertaintyWrapper.svg?branch=master"
    />
</a>
</p>


<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="more_examples/complex_example.html">Complex Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="more_examples/python_extension_example_with_units.html">Python Extension Example with Units</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-uncertainty_wrapper.core">Uncertainty Wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-uncertainty_wrapper.tests.test_uncertainty_wrapper">Tests</a></li>
</ul>
</li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="more_examples/python_extension_example_with_units.html" title="previous chapter">Python Extension Example with Units</a></li>
  </ul></li>
</ul>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, SunPower.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/api.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/BreakingBytes/UncertaintyWrapper" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>